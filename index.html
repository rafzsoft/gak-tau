<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>WhatsApp Bot Activity</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f7f9fc; }
    .activity-list { max-height:75vh; overflow:auto; }
    .card { border-radius:12px; box-shadow:0 2px 4px rgba(0,0,0,.05); }
    pre { background:#f1f3f5; border-radius:6px; padding:6px; }
  </style>
</head>
<body>
  <div class="container py-4">
    <h1 class="mb-3 text-center">üìä WhatsApp Bot Activity</h1>

    <div class="mb-3 d-flex gap-2">
      <input id="filter" class="form-control" placeholder="Cari teks / nomor / tipe (Enter untuk filter)">
      <button id="clear" class="btn btn-outline-secondary">Clear</button>
    </div>

    <div class="alert alert-info py-2 small mb-3">
      Status koneksi: <span id="status">Connecting...</span>
    </div>

    <div id="list" class="activity-list"></div>
  </div>

  <script>
  // ====== KONFIGURASI ======
  const WS_URL = "wss://your-websocket-server.example.com"; // ganti dengan endpoint WebSocket bot kamu
  // contoh kalau pakai polling REST:
  // const API_URL = "https://your-api-server.example.com/api/events";

  // ====== INISIALISASI ======
  const listEl = document.getElementById("list");
  const statusEl = document.getElementById("status");
  const filterInput = document.getElementById("filter");
  const clearBtn = document.getElementById("clear");
  let filter = "";
  let events = [];

  function escapeHtml(str) {
    if (!str) return "";
    return String(str)
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/\"/g,"&quot;")
      .replace(/'/g,"&#039;");
  }

  function render() {
    const filtered = events.filter(e=>{
      if(!filter) return true;
      const f=filter.toLowerCase();
      return e.type.toLowerCase().includes(f)
          || (e.text||"").toLowerCase().includes(f)
          || (e.from||"").toLowerCase().includes(f);
    });

    listEl.innerHTML = filtered.map(e => `
      <div class="card mb-2">
        <div class="card-body py-2">
          <div class="d-flex justify-content-between">
            <div>
              <strong>${escapeHtml(e.type)}</strong>
              <span class="text-muted">‚Äî ${escapeHtml(e.from || '-')}</span>
            </div>
            <small class="text-muted">${new Date(e._ts || Date.now()).toLocaleString()}</small>
          </div>
          ${e.text ? `<div class="mt-2">${escapeHtml(e.text)}</div>` : ''}
          ${e.meta ? `<pre class="mt-2 small">${escapeHtml(JSON.stringify(e.meta,null,2))}</pre>` : ''}
        </div>
      </div>
    `).join("") || `<div class="text-muted">Belum ada aktivitas.</div>`;
  }

  // ====== FILTER ======
  filterInput.addEventListener("keydown",e=>{
    if(e.key==="Enter"){ filter = filterInput.value.trim(); render(); }
  });
  clearBtn.addEventListener("click",()=>{
    filter = ""; filterInput.value=""; render();
  });

  // ====== KONEKSI WEBSOCKET ======
  let socket;
  function connectWS() {
    statusEl.textContent = "Menghubungkan...";
    socket = new WebSocket(https://always-acap.dxyvxz.my.id);

    socket.addEventListener("open",()=>{
      statusEl.textContent = "Terhubung ‚úÖ";
    });

    socket.addEventListener("message",(msg)=>{
      try {
        const evt = JSON.parse(msg.data);
        evt._ts = new Date().toISOString();
        events.unshift(evt);
        if (events.length > 1000) events.pop();
        render();
      } catch(e) {
        console.error("Invalid JSON:", msg.data);
      }
    });

    socket.addEventListener("close",()=>{
      statusEl.textContent = "Terputus üîÑ (reconnect 5s)";
      setTimeout(connectWS,5000);
    });

    socket.addEventListener("error",()=>{
      statusEl.textContent = "Error koneksi ‚ö†Ô∏è";
      socket.close();
    });
  }
  connectWS();
  </script>
</body>
</html>